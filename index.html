// JANコードパターン判定機能を追加したスタンドアロンアプリケーション
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JANコードキャンペーン確認ツール</title>
    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #34495e;
            --light-color: #ecf0f1;
            --font-size-normal: 16px;
            --font-size-large: 18px;
            --font-size-xlarge: 20px;
            --spacing-small: 8px;
            --spacing-medium: 16px;
            --spacing-large: 24px;
        }

        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Noto Sans JP', Meiryo, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
            font-size: var(--font-size-normal);
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: var(--spacing-medium);
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            min-height: 100vh;
        }

        header {
            text-align: center;
            margin-bottom: var(--spacing-large);
            padding-bottom: var(--spacing-medium);
            border-bottom: 1px solid #eee;
        }

        h1 {
            font-size: 1.5rem;
            margin: 0;
            padding: var(--spacing-medium) 0;
            color: var(--dark-color);
        }

        .search-section {
            margin-bottom: var(--spacing-large);
        }

        .search-input {
            display: flex;
            margin-bottom: var(--spacing-medium);
        }

        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
            font-size: var(--font-size-normal);
        }

        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-size: var(--font-size-normal);
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        button.search-button {
            border-radius: 0 4px 4px 0;
        }

        button:hover {
            background-color: #2980b9;
        }

        .scan-button {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: var(--spacing-medium);
            background-color: var(--dark-color);
        }

        .scan-button i {
            margin-right: 8px;
        }

        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: var(--spacing-medium);
        }

        .test-button {
            background-color: #7f8c8d;
            font-size: 0.8rem;
            padding: 8px 12px;
            flex: 1;
            min-width: 80px;
            text-align: center;
        }

        .accessibility-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: var(--spacing-medium);
        }

        .font-size-controls, .contrast-controls {
            display: flex;
            align-items: center;
        }

        .control-button {
            background-color: #95a5a6;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 4px;
            font-weight: bold;
            padding: 0;
        }

        .result-section {
            margin-top: var(--spacing-large);
            display: none;
        }

        .product-info {
            background-color: var(--light-color);
            padding: var(--spacing-medium);
            border-radius: 4px;
            margin-bottom: var(--spacing-medium);
        }

        .product-name {
            font-size: var(--font-size-large);
            font-weight: bold;
            margin-bottom: var(--spacing-small);
        }

        .product-details {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-small);
            margin-bottom: var(--spacing-small);
        }

        .product-detail {
            background-color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.9rem;
        }

        .campaigns-list {
            margin-top: var(--spacing-medium);
        }

        .campaign-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: var(--spacing-medium);
            overflow: hidden;
        }

        .campaign-header {
            padding: var(--spacing-medium);
            font-weight: bold;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .applicable {
            background-color: var(--success-color);
            color: white;
        }

        .not-applicable {
            background-color: var(--danger-color);
            color: white;
        }

        .campaign-status {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 4px;
            background-color: white;
        }

        .campaign-body {
            padding: var(--spacing-medium);
            background-color: white;
        }

        .campaign-period, .campaign-description {
            margin-bottom: var(--spacing-small);
        }

        .campaign-notes {
            font-size: 0.9rem;
            background-color: #f8f9fa;
            padding: var(--spacing-small);
            border-radius: 4px;
            margin-top: var(--spacing-small);
        }

        .show-more-button {
            background-color: #f8f9fa;
            color: #333;
            text-align: center;
            padding: var(--spacing-small);
            cursor: pointer;
            border-top: 1px solid #ddd;
        }

        .campaign-details {
            display: none;
            padding: var(--spacing-medium);
            background-color: #f8f9fa;
            border-top: 1px solid #ddd;
        }

        .loading {
            text-align: center;
            padding: var(--spacing-large);
            display: none;
        }

        .error-message {
            color: var(--danger-color);
            text-align: center;
            padding: var(--spacing-medium);
            display: none;
        }

        .scanner-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #scanner-preview {
            width: 100%;
            max-width: 500px;
            height: 300px;
            background-color: #000;
            position: relative;
        }

        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            pointer-events: none;
        }

        .scan-region-highlight {
            border: 2px solid rgba(255, 255, 255, 0.5);
            position: absolute;
            width: 80%;
            height: 30%;
            left: 10%;
            top: 35%;
        }

        .scanner-instructions {
            color: white;
            text-align: center;
            padding: var(--spacing-medium);
            background-color: rgba(0, 0, 0, 0.7);
        }

        .close-scanner {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: rgba(255, 255, 255, 0.3);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
        }

        .high-contrast {
            filter: contrast(1.5);
        }

        @media (max-width: 480px) {
            .container {
                padding: var(--spacing-small);
            }
            
            h1 {
                font-size: 1.3rem;
            }
            
            .test-buttons {
                gap: 4px;
            }
            
            .test-button {
                font-size: 0.7rem;
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>JANコードキャンペーン確認ツール</h1>
        </header>

        <div class="accessibility-controls">
            <div class="font-size-controls">
                <span>文字サイズ:</span>
                <button class="control-button" id="decrease-font">A-</button>
                <button class="control-button" id="increase-font">A+</button>
            </div>
            <div class="contrast-controls">
                <span>コントラスト:</span>
                <button class="control-button" id="toggle-contrast">C</button>
            </div>
        </div>

        <div class="search-section">
            <div class="search-input">
                <input type="text" id="jan-input" placeholder="JANコードを入力" maxlength="13">
                <button class="search-button">検索</button>
            </div>
            <button class="scan-button" id="scan-button">
                <i>📷</i> QRコード
            </button>
            <div class="test-buttons">
                <button class="test-button" data-jan="4549526123456">エディフィス</button>
                <button class="test-button" data-jan="4549526789012">G-SHOCK</button>
                <button class="test-button" data-jan="4549526345678">オシアナス</button>
                <button class="test-button" data-jan="4974375123456">アテッサ</button>
                <button class="test-button" data-jan="4974375789012">シチズン</button>
            </div>
        </div>

        <div class="loading">
            <p>読み込み中...</p>
        </div>

        <div class="error-message" id="error-message">
            <p>エラーが発生しました。もう一度お試しください。</p>
        </div>

        <div class="result-section" id="result-section">
            <div class="product-info">
                <div class="product-name" id="product-name"></div>
                <div class="product-details">
                    <div class="product-detail" id="product-brand"></div>
                    <div class="product-detail" id="product-category"></div>
                    <div class="product-detail" id="product-price"></div>
                </div>
            </div>

            <h2>適用キャンペーン</h2>
            <div class="campaigns-list" id="campaigns-list">
                <!-- キャンペーン情報がここに動的に追加されます -->
            </div>
        </div>
    </div>

    <div class="scanner-container" id="scanner-container">
        <button class="close-scanner" id="close-scanner">×</button>
        <div id="scanner-preview"></div>
        <div class="scanner-instructions">
            <p>JANコードをカメラに向けてスキャンしてください</p>
        </div>
    </div>

    <!-- QuaggaJSライブラリの読み込み -->
    <script src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>

    <script>
        // 商品データ
        const productsData = [
            {
                "jan": "4549526123456",
                "name": "エディフィス カラーダイヤルシリーズ EFR-123",
                "brand": "CASIO",
                "category": "腕時計",
                "price": 35000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPkVESUZJQ0U8L3RleHQ+PC9zdmc+"
            },
            {
                "jan": "4549526789012",
                "name": "G-SHOCK フルメタル GMW-B5000",
                "brand": "CASIO",
                "category": "腕時計",
                "price": 70000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPkctU0hPQ0s8L3RleHQ+PC9zdmc+"
            },
            {
                "jan": "4549526345678",
                "name": "オシアナス OCW-S100",
                "brand": "CASIO",
                "category": "腕時計",
                "price": 120000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPk9DRUFOVVM8L3RleHQ+PC9zdmc+"
            },
            {
                "jan": "4974375123456",
                "name": "アテッサ AT8040-57E",
                "brand": "CITIZEN",
                "category": "腕時計",
                "price": 85000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPkFUVEVTQTwvdGV4dD48L3N2Zz4="
            },
            {
                "jan": "4974375789012",
                "name": "シチズンコレクション BM6770-51G",
                "brand": "CITIZEN",
                "category": "腕時計",
                "price": 32000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPkNJVElaRU48L3RleHQ+PC9zdmc+"
            },
            {
                "jan": "4974375345678",
                "name": "xC クロスシー EC1144-51W",
                "brand": "CITIZEN",
                "category": "腕時計",
                "price": 75000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPnhDPC90ZXh0Pjwvc3ZnPg=="
            },
            {
                "jan": "4954628123456",
                "name": "セイコー プレザージュ SARX033",
                "brand": "SEIKO",
                "category": "腕時計",
                "price": 95000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPlBSRVNBR0U8L3RleHQ+PC9zdmc+"
            },
            {
                "jan": "4954628789012",
                "name": "セイコー プロスペックス SBDC053",
                "brand": "SEIKO",
                "category": "腕時計",
                "price": 70000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPlBST1NQRVg8L3RleHQ+PC9zdmc+"
            },
            {
                "jan": "4954628345678",
                "name": "セイコー ルキア SSQV042",
                "brand": "SEIKO",
                "category": "腕時計",
                "price": 60000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPkxVS0lBPC90ZXh0Pjwvc3ZnPg=="
            },
            {
                "jan": "4954628901234",
                "name": "セイコー アストロン SBXC003",
                "brand": "SEIKO",
                "category": "腕時計",
                "price": 180000,
                "image": "data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMDAiIGhlaWdodD0iMjAwIiB2aWV3Qm94PSIwIDAgMjAwIDIwMCI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiNlZWUiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1zaXplPSIxOCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgYWxpZ25tZW50LWJhc2VsaW5lPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UsIHNhbnMtc2VyaWYiIGZpbGw9IiNBQUEiPkFTVFJPTjwvdGV4dD48L3N2Zz4="
            }
        ];

        // キャンペーンデータ
        const campaignsData = [
            {
                "id": "casio_warranty",
                "name": "カシオ保証延長キャンペーン",
                "period": "2025年3月14日～4月6日",
                "description": "対象商品を購入で、通常有償となる延長保証1年分を無料にて付与、2年保証とする特別キャンペーン",
                "benefit": "延長保証1年分無料（通常1,000円相当）",
                "notes": "差額を頂いて、3年保証・4年保証に延長することも可能です。オシアナスについては、メーカー保証が3年となりますが、外装に保証が付くことを訴求しています。",
                "details": "レジ操作の際に、延長保証1年分を通常通り押して、金額を0円へ訂正しお会計を実施してください。3年保証・4年保証へ延長する場合は、必ず差額を頂いてください。※3年保証の場合、差額1,100円 4年保証の場合、差額2,200円（スタンダードの場合）"
            },
            {
                "id": "citizen_warranty",
                "name": "シチズン保証延長キャンペーン",
                "period": "2025年2月21日～3月23日",
                "description": "対象商品を購入で、通常有償となる延長保証1年分を無料にて付与、2年保証とする特別キャンペーン",
                "benefit": "延長保証1年分無料（通常1,000円相当）",
                "notes": "差額を頂いて、3年保証・4年保証に延長することも可能です。",
                "details": "レジ操作の際に、延長保証1年分を通常通り押して、金額を0円へ訂正しお会計を実施してください。3年保証・4年保証へ延長する場合は、必ず差額を頂いてください。※3年保証の場合、差額1,100円 4年保証の場合、差額2,200円（スタンダードの場合）"
            },
            {
                "id": "citizen_interest_free",
                "name": "シチズン分割金利無料キャンペーン",
                "period": "2025年2月21日～3月23日",
                "description": "ジャックスローン通常20回までの金利無料を、シチズン商品に限り、30回まで金利無料とする特別キャンペーン",
                "benefit": "分割払い最大30回まで金利手数料無料",
                "notes": "フレッシャーズ需要での単価アップを目指します。金利手数料はメーカー負担。",
                "details": "通常通りジャックスのページよりお客様情報入力などを実施してください。申し込みで不明なことがあれば、必ずジャックスの担当者へ確認してください。"
            },
            {
                "id": "freshers_discount",
                "name": "フレッシャーズ割引キャンペーン",
                "period": "2025年2月25日～4月6日まで実施",
                "description": "学生・新社会人の方を対象に、MAX20%OFFでの割引を実施する特別キャンペーン",
                "benefit": "最大20%OFF",
                "notes": "割引率は、一覧表を添付しますので、各店舗で決めて頂ければと思います。学生・新社会人の見分けについては、自己申告となります。",
                "details": "商品部の定める割引率の範囲内内で設定をしてください。各ブランドの割引率については、各バイヤーまでお問い合わせください。PB・特価品・割引を禁止されている商材については対象外となります。"
            },
            {
                "id": "seiko_gift",
                "name": "セイコー商品券プレゼントキャンペーン",
                "period": "2025年3月1日～3月31日",
                "description": "対象のセイコー腕時計を購入で、商品券をプレゼント",
                "benefit": "商品券5,000円分プレゼント",
                "notes": "プレザージュ、プロスペックス、アストロンが対象です。",
                "details": "対象商品購入時にレジにて商品券をお渡しください。後日の申請は対応できませんのでご注意ください。"
            },
            {
                "id": "anniversary_70th",
                "name": "創業70周年特別ご招待企画",
                "period": "2025年3月20日(水)～3月23日(土)",
                "description": "ご予約頂いた販売価格の約10%分の自社お買物券をお渡しし、特招会実施期間中にお会計をして頂く特別企画",
                "benefit": "約10%分のお買物券進呈",
                "notes": "対象商品は、税込33,000円以上の腕時計。当日予約なしでの来店は、対象外となります。",
                "details": "お買物券の種類は、3,000円券・5,000円券・10,000円券の3種類です。割引は税込み価格に対して適用してください。購入金額の10%以上の金額分のお買物券の配布は禁止です。"
            }
        ];

        // 商品-キャンペーン関連データ
        const productCampaignsData = [
            {
                "jan": "4549526123456",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": true,
                        "reason": "エディフィスカラーダイヤルシリーズは対象商品のため"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "カシオ製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "カシオ製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "カシオ製品のため、セイコーキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4549526789012",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": true,
                        "reason": "G-SHOCKフルメタルは対象商品のため"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "カシオ製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "カシオ製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "カシオ製品のため、セイコーキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4549526345678",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": true,
                        "reason": "オシアナスは対象商品のため"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "カシオ製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "カシオ製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": false,
                        "reason": "高級ラインのため、フレッシャーズ割引対象外"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "カシオ製品のため、セイコーキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4974375123456",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "シチズン製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": true,
                        "reason": "アテッサは対象商品のため"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": true,
                        "reason": "シチズン商品は分割金利無料キャンペーン対象"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "シチズン製品のため、セイコーキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4974375789012",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "シチズン製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": true,
                        "reason": "シチズンコレクションは対象商品のため"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": true,
                        "reason": "シチズン商品は分割金利無料キャンペーン対象"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "シチズン製品のため、セイコーキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": false,
                        "reason": "税込33,000円未満のため対象外"
                    }
                ]
            },
            {
                "jan": "4974375345678",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "シチズン製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": true,
                        "reason": "xCは対象商品のため"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": true,
                        "reason": "シチズン商品は分割金利無料キャンペーン対象"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "シチズン製品のため、セイコーキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4954628123456",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": true,
                        "reason": "プレザージュは対象商品のため"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4954628789012",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": true,
                        "reason": "プロスペックスは対象商品のため"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4954628345678",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": true,
                        "reason": "フレッシャーズ割引対象商品のため（学生・新社会人のみ）"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": false,
                        "reason": "ルキアはキャンペーン対象外"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            },
            {
                "jan": "4954628901234",
                "campaigns": [
                    {
                        "campaign_id": "casio_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、カシオキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_warranty",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "citizen_interest_free",
                        "applicable": false,
                        "reason": "セイコー製品のため、シチズンキャンペーン対象外"
                    },
                    {
                        "campaign_id": "freshers_discount",
                        "applicable": false,
                        "reason": "高級ラインのため、フレッシャーズ割引対象外"
                    },
                    {
                        "campaign_id": "seiko_gift",
                        "applicable": true,
                        "reason": "アストロンは対象商品のため"
                    },
                    {
                        "campaign_id": "anniversary_70th",
                        "applicable": true,
                        "reason": "税込33,000円以上の腕時計のため対象（要予約）"
                    }
                ]
            }
        ];

        // JANコードからメーカーを判定する関数
        function getManufacturerFromJAN(janCode) {
            if (janCode.startsWith('4549526') || janCode.startsWith('4971850')) {
                return 'CASIO';
            } else if (janCode.startsWith('4974375')) {
                return 'CITIZEN';
            } else if (janCode.startsWith('4954628')) {
                return 'SEIKO';
            } else {
                return 'UNKNOWN';
            }
        }

        // JANコードからシリーズを推定する関数
        function getSeriesFromJAN(janCode, manufacturer) {
            if (manufacturer === 'CASIO') {
                // カシオの場合、特定のパターンでシリーズを判定
                // 実際には、より詳細なパターンマッチングが必要
                if (janCode.substring(7, 9) === '12') {
                    return 'EDIFICE';
                } else if (janCode.substring(7, 9) === '34') {
                    return 'OCEANUS';
                } else if (janCode.substring(7, 9) === '78') {
                    return 'G-SHOCK';
                }
            } else if (manufacturer === 'CITIZEN') {
                // シチズンの場合
                if (janCode.substring(7, 9) === '12') {
                    return 'ATTESA';
                } else if (janCode.substring(7, 9) === '34') {
                    return 'xC';
                } else if (janCode.substring(7, 9) === '78') {
                    return 'CITIZEN COLLECTION';
                }
            } else if (manufacturer === 'SEIKO') {
                // セイコーの場合
                if (janCode.substring(7, 9) === '12') {
                    return 'PRESAGE';
                } else if (janCode.substring(7, 9) === '78') {
                    return 'PROSPEX';
                } else if (janCode.substring(7, 9) === '34') {
                    return 'LUKIA';
                } else if (janCode.substring(7, 9) === '90') {
                    return 'ASTRON';
                }
            }
            
            return 'UNKNOWN';
        }

        // キャンペーン適用可否を判定する関数
        function isCampaignApplicable(janCode, campaignId, price) {
            // まず登録済みの商品-キャンペーン関連データから検索
            const productCampaign = productCampaignsData.find(pc => pc.jan === janCode);
            if (productCampaign) {
                const campaign = productCampaign.campaigns.find(c => c.campaign_id === campaignId);
                if (campaign) {
                    return {
                        applicable: campaign.applicable,
                        reason: campaign.reason
                    };
                }
            }
            
            // 登録済みデータがない場合は、JANコードのパターンから判定
            const manufacturer = getManufacturerFromJAN(janCode);
            const series = getSeriesFromJAN(janCode, manufacturer);
            
            // 商品情報を取得（価格などの情報が必要な場合）
            const product = productsData.find(p => p.jan === janCode) || { price: 0 };
            
            switch (campaignId) {
                case 'casio_warranty':
                    // カシオ保証延長キャンペーン
                    if (manufacturer === 'CASIO') {
                        if (series === 'EDIFICE' || series === 'OCEANUS' || series === 'G-SHOCK') {
                            return {
                                applicable: true,
                                reason: `${series}シリーズは対象商品のため`
                            };
                        } else {
                            return {
                                applicable: false,
                                reason: `${series}シリーズは対象外`
                            };
                        }
                    } else {
                        return {
                            applicable: false,
                            reason: `${manufacturer}製品のため、カシオキャンペーン対象外`
                        };
                    }
                
                case 'citizen_warranty':
                case 'citizen_interest_free':
                    // シチズン保証延長・分割無金利キャンペーン
                    if (manufacturer === 'CITIZEN') {
                        if (series === 'ATTESA' || series === 'xC' || series === 'CITIZEN COLLECTION') {
                            return {
                                applicable: true,
                                reason: `${series}は対象商品のため`
                            };
                        } else {
                            return {
                                applicable: false,
                                reason: `${series}シリーズは対象外`
                            };
                        }
                    } else {
                        return {
                            applicable: false,
                            reason: `${manufacturer}製品のため、シチズンキャンペーン対象外`
                        };
                    }
                
                case 'freshers_discount':
                    // フレッシャーズ割引キャンペーン
                    // 高級ラインは対象外とする例
                    if (product.price > 100000) {
                        return {
                            applicable: false,
                            reason: `高級ラインのため、フレッシャーズ割引対象外`
                        };
                    } else {
                        return {
                            applicable: true,
                            reason: `フレッシャーズ割引対象商品のため（学生・新社会人のみ）`
                        };
                    }
                
                case 'seiko_gift':
                    // セイコー商品券プレゼントキャンペーン
                    if (manufacturer === 'SEIKO') {
                        if (series === 'PRESAGE' || series === 'PROSPEX' || series === 'ASTRON') {
                            return {
                                applicable: true,
                                reason: `${series}は対象商品のため`
                            };
                        } else {
                            return {
                                applicable: false,
                                reason: `${series}はキャンペーン対象外`
                            };
                        }
                    } else {
                        return {
                            applicable: false,
                            reason: `${manufacturer}製品のため、セイコーキャンペーン対象外`
                        };
                    }
                
                case 'anniversary_70th':
                    // 創業70周年特別ご招待企画
                    if (product.price >= 33000) {
                        return {
                            applicable: true,
                            reason: `税込33,000円以上の腕時計のため対象（要予約）`
                        };
                    } else {
                        return {
                            applicable: false,
                            reason: `税込33,000円未満のため対象外`
                        };
                    }
                
                default:
                    return {
                        applicable: false,
                        reason: `不明なキャンペーンID: ${campaignId}`
                    };
            }
        }

        // DOM要素
        const janInput = document.getElementById('jan-input');
        const searchButton = document.querySelector('.search-button');
        const scanButton = document.getElementById('scan-button');
        const testButtons = document.querySelectorAll('.test-button');
        const resultSection = document.getElementById('result-section');
        const campaignsList = document.getElementById('campaigns-list');
        const productName = document.getElementById('product-name');
        const productBrand = document.getElementById('product-brand');
        const productCategory = document.getElementById('product-category');
        const productPrice = document.getElementById('product-price');
        const loadingElement = document.querySelector('.loading');
        const errorMessage = document.getElementById('error-message');
        const scannerContainer = document.getElementById('scanner-container');
        const closeScanner = document.getElementById('close-scanner');
        const decreaseFontButton = document.getElementById('decrease-font');
        const increaseFontButton = document.getElementById('increase-font');
        const toggleContrastButton = document.getElementById('toggle-contrast');

        // 検索処理
        function searchProduct(janCode) {
            console.log(`検索開始: ${janCode}`);
            
            // 表示をリセット
            resultSection.style.display = 'none';
            errorMessage.style.display = 'none';
            loadingElement.style.display = 'block';
            
            // 少し遅延を入れて処理中の表示を見せる
            setTimeout(() => {
                try {
                    // 商品データから検索
                    const product = productsData.find(p => p.jan === janCode);
                    
                    if (product) {
                        console.log('商品が見つかりました:', product);
                        
                        // 商品情報を表示
                        productName.textContent = product.name;
                        productBrand.textContent = product.brand;
                        productCategory.textContent = product.category;
                        productPrice.textContent = `${product.price.toLocaleString()}円`;
                        
                        // キャンペーン情報をクリア
                        campaignsList.innerHTML = '';
                        
                        // 各キャンペーンの適用可否を判定して表示
                        campaignsData.forEach(campaign => {
                            // 登録済みの商品-キャンペーン関連データから検索
                            let applicableInfo;
                            const productCampaign = productCampaignsData.find(pc => pc.jan === janCode);
                            
                            if (productCampaign) {
                                const campaignRelation = productCampaign.campaigns.find(c => c.campaign_id === campaign.id);
                                if (campaignRelation) {
                                    applicableInfo = {
                                        applicable: campaignRelation.applicable,
                                        reason: campaignRelation.reason
                                    };
                                }
                            }
                            
                            // 登録済みデータがない場合は、JANコードのパターンから判定
                            if (!applicableInfo) {
                                applicableInfo = isCampaignApplicable(janCode, campaign.id, product.price);
                            }
                            
                            // キャンペーン情報のHTML要素を作成
                            const campaignItem = document.createElement('div');
                            campaignItem.className = 'campaign-item';
                            
                            const headerClass = applicableInfo.applicable ? 'applicable' : 'not-applicable';
                            const statusText = applicableInfo.applicable ? '適用可' : '適用不可';
                            
                            campaignItem.innerHTML = `
                                <div class="campaign-header ${headerClass}">
                                    ${campaign.name}
                                    <span class="campaign-status">${statusText}</span>
                                </div>
                                <div class="campaign-body">
                                    <div class="campaign-period">期間: ${campaign.period}</div>
                                    <div class="campaign-description">${campaign.benefit}</div>
                                    <div class="campaign-notes">${applicableInfo.reason}</div>
                                </div>
                                <div class="show-more-button">もっと見る ▼</div>
                                <div class="campaign-details">
                                    <p>${campaign.description}</p>
                                    <p>${campaign.notes}</p>
                                    <p>${campaign.details}</p>
                                </div>
                            `;
                            
                            campaignsList.appendChild(campaignItem);
                            
                            // 「もっと見る」ボタンのイベントリスナーを追加
                            const showMoreButton = campaignItem.querySelector('.show-more-button');
                            const campaignDetails = campaignItem.querySelector('.campaign-details');
                            
                            showMoreButton.addEventListener('click', () => {
                                if (campaignDetails.style.display === 'block') {
                                    campaignDetails.style.display = 'none';
                                    showMoreButton.textContent = 'もっと見る ▼';
                                } else {
                                    campaignDetails.style.display = 'block';
                                    showMoreButton.textContent = '閉じる ▲';
                                }
                            });
                        });
                        
                        // 結果を表示
                        resultSection.style.display = 'block';
                        loadingElement.style.display = 'none';
                        
                    } else {
                        console.log('商品が見つかりませんでした');
                        
                        // JANコードのパターンから推定
                        const manufacturer = getManufacturerFromJAN(janCode);
                        
                        if (manufacturer !== 'UNKNOWN') {
                            // メーカーが判別できた場合は、推定情報を表示
                            const series = getSeriesFromJAN(janCode, manufacturer);
                            
                            // 推定商品情報を表示
                            productName.textContent = `${manufacturer} ${series} (推定)`;
                            productBrand.textContent = manufacturer;
                            productCategory.textContent = '腕時計';
                            productPrice.textContent = '価格不明';
                            
                            // キャンペーン情報をクリア
                            campaignsList.innerHTML = '';
                            
                            // 各キャンペーンの適用可否を判定して表示
                            campaignsData.forEach(campaign => {
                                const applicableInfo = isCampaignApplicable(janCode, campaign.id, 0);
                                
                                // キャンペーン情報のHTML要素を作成
                                const campaignItem = document.createElement('div');
                                campaignItem.className = 'campaign-item';
                                
                                const headerClass = applicableInfo.applicable ? 'applicable' : 'not-applicable';
                                const statusText = applicableInfo.applicable ? '適用可' : '適用不可';
                                
                                campaignItem.innerHTML = `
                                    <div class="campaign-header ${headerClass}">
                                        ${campaign.name}
                                        <span class="campaign-status">${statusText}</span>
                                    </div>
                                    <div class="campaign-body">
                                        <div class="campaign-period">期間: ${campaign.period}</div>
                                        <div class="campaign-description">${campaign.benefit}</div>
                                        <div class="campaign-notes">${applicableInfo.reason}</div>
                                    </div>
                                    <div class="show-more-button">もっと見る ▼</div>
                                    <div class="campaign-details">
                                        <p>${campaign.description}</p>
                                        <p>${campaign.notes}</p>
                                        <p>${campaign.details}</p>
                                    </div>
                                `;
                                
                                campaignsList.appendChild(campaignItem);
                                
                                // 「もっと見る」ボタンのイベントリスナーを追加
                                const showMoreButton = campaignItem.querySelector('.show-more-button');
                                const campaignDetails = campaignItem.querySelector('.campaign-details');
                                
                                showMoreButton.addEventListener('click', () => {
                                    if (campaignDetails.style.display === 'block') {
                                        campaignDetails.style.display = 'none';
                                        showMoreButton.textContent = 'もっと見る ▼';
                                    } else {
                                        campaignDetails.style.display = 'block';
                                        showMoreButton.textContent = '閉じる ▲';
                                    }
                                });
                            });
                            
                            // 結果を表示
                            resultSection.style.display = 'block';
                            loadingElement.style.display = 'none';
                            
                        } else {
                            // 商品が見つからず、メーカーも推定できない場合はエラーメッセージを表示
                            errorMessage.style.display = 'block';
                            loadingElement.style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.error('検索処理でエラーが発生しました:', error);
                    errorMessage.style.display = 'block';
                    loadingElement.style.display = 'none';
                }
            }, 500);
        }

        // 検索ボタンのイベントリスナー
        searchButton.addEventListener('click', () => {
            const janCode = janInput.value.trim();
            if (janCode) {
                searchProduct(janCode);
            }
        });

        // JANコード入力欄のEnterキーイベントリスナー
        janInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const janCode = janInput.value.trim();
                if (janCode) {
                    searchProduct(janCode);
                }
            }
        });

        // テスト用ボタンのイベントリスナー
        testButtons.forEach(button => {
            button.addEventListener('click', () => {
                const janCode = button.getAttribute('data-jan');
                janInput.value = janCode;
                searchProduct(janCode);
            });
        });

        // バーコードスキャン機能
        scanButton.addEventListener('click', () => {
            scannerContainer.style.display = 'flex';
            
            // Quaggaの初期化
            Quagga.init({
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: document.querySelector('#scanner-preview'),
                    constraints: {
                        facingMode: "environment" // リアカメラを使用
                    }
                },
                locator: {
                    patchSize: "medium",
                    halfSample: true
                },
                numOfWorkers: 2,
                decoder: {
                    readers: ["ean_reader"] // EAN-13（JAN-13）とEAN-8（JAN-8）に対応
                },
                locate: true
            }, function(err) {
                if (err) {
                    console.error('Quaggaの初期化に失敗しました:', err);
                    return;
                }
                console.log('Quaggaが初期化されました');
                Quagga.start();
            });
            
            // スキャン結果のイベントリスナー
            Quagga.onDetected(function(result) {
                const code = result.codeResult.code;
                console.log('バーコードを検出しました:', code);
                
                // スキャナーを停止して閉じる
                Quagga.stop();
                scannerContainer.style.display = 'none';
                
                // 検索を実行
                janInput.value = code;
                searchProduct(code);
            });
        });

        // スキャナーを閉じるボタンのイベントリスナー
        closeScanner.addEventListener('click', () => {
            Quagga.stop();
            scannerContainer.style.display = 'none';
        });

        // アクセシビリティ機能: 文字サイズ変更
        let currentFontSize = 16; // デフォルトのフォントサイズ
        
        decreaseFontButton.addEventListener('click', () => {
            if (currentFontSize > 12) {
                currentFontSize -= 2;
                document.documentElement.style.setProperty('--font-size-normal', `${currentFontSize}px`);
                document.documentElement.style.setProperty('--font-size-large', `${currentFontSize + 2}px`);
                document.documentElement.style.setProperty('--font-size-xlarge', `${currentFontSize + 4}px`);
            }
        });
        
        increaseFontButton.addEventListener('click', () => {
            if (currentFontSize < 24) {
                currentFontSize += 2;
                document.documentElement.style.setProperty('--font-size-normal', `${currentFontSize}px`);
                document.documentElement.style.setProperty('--font-size-large', `${currentFontSize + 2}px`);
                document.documentElement.style.setProperty('--font-size-xlarge', `${currentFontSize + 4}px`);
            }
        });
        
        // アクセシビリティ機能: コントラスト切り替え
        toggleContrastButton.addEventListener('click', () => {
            document.body.classList.toggle('high-contrast');
        });
    </script>
</body>
</html>
